## For DeepHB topic analysis, I require a set of background sequences not associated with 
## peaks identified in current analyss or any other known analysis
## I used following commands to obtain this peak set
cd ~/DeepHB/extrafiles
allpeaks=~/ATACana/Outs/PeakCom/AllPeaks_robust.sorted.fil.bed
bedtools random -g chromSizes_canchrom.genome -l 500 -n 15000 -seed 1987 | \
  bedtools intersect -v -a stdin -b $allpeaks | \
  bedtools intersect -v -a stdin -b GRCh38-cCREs.bed | \
  bedtools intersect -v -a stdin -b gencdH38p13r37_exons.bed | \
  bedtools intersect -v -a stdin -b hg38_UCSC_gaps.bed > HG38_random_peaks.bed
sort -k 1,1 -k2,2n HG38_random_peaks.bed > HG38_random_peaks.sort.bed
##checking for N's
bedtools getfasta -fi ~/genome/gencdH38p13r37.fa -bed HG38_random_peaks.sort.bed -fo HG38_random_peaks.fa
grep N HG38_random_peaks.fa | wc -l ##No N's!!s

##below code was run in R
DIRO <- "~/DeepHB/TopicMP_CREs/"
setwd(DIRO)
##random background peaks----
rand_peaks <- read.delim("~/DeepHB/extrafiles/HG38_random_peaks.sort.bed",header = FALSE)
head(rand_peaks)
len <- dim(rand_peaks)[1]
rand_peaks2 <- rand_peaks[sample(seq(len),2000),c(1:3)]
rand_peaks2$V4 <- paste0(rand_peaks2$V1,":",rand_peaks2$V2,"-",rand_peaks2$V3)
rand_peaks2$V5 <- "MP00"
head(rand_peaks2)

write.table(rand_peaks2,file = paste0(DIRO,"TopicMP_CREs/MP00_CREs.bed"),
            sep = "\t",row.names = FALSE, col.names = FALSE, quote = FALSE)
##



##files in extrafiles for this analysis

## GRCh38-cCREs.bed: ENCODE cCREs downloaded from here: https://screen.encodeproject.org/index/cversions
https://downloads.wenglab.org/V3/GRCh38-cCREs.bed

##hg38_UCSC_gaps.bed: These are gaps in human chromsome assembly. 
downloaded as below
go to http://genome.ucsc.edu/cgi-bin/hgTables
select human, Grch38, mapping and sequecning and gap
the Genome as region of interes, output format "BED" and add file name "hg38_UCSC_gaps.bed". hit getoutput
on next page click whole gene and getBed.
the file already looks sorted

##ggencdH38p13r37_exons.bed
Using gencdH38p13r37.bed that was generated form gencdH38p13r37.gtf in HB/ann folder
extracted "exons" using
awk -v OFS="\t" '{if($8="exons") print $1, $2, $3, $4}' gencdH38p13r37.bed > gencdH38p13r37_exons.bed
##remove nonchar chromoes
created chromSizes_canchrom.bed from chromSizes.bed after removing noncanonical chromosomes
converted chromSizes_canchrom.bed to chromSizes_canchrom.genome for bedtools bed which requires this format

bedtools intersect -wa -a gencdH38p13r37_exons.bed -b chromSizes_canchrom.bed > del.bed
mv del.bed gencdH38p13r37_exons.bed


